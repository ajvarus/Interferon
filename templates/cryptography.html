<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Interferon</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='favicon.png') }}"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='font.css') }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <!-- <script defer src="https://pyscript.net/latest/pyscript.js"></script> -->
  </head>
  <body class="container py-5">
    <div id="body-container">
      {% include 'navbar.html' %}

      <h2 class="mb-4">{{ crypt_type.get('display_name') }}</h2>

      <div class="form-group mb-3">
        <label for="encryptionType"
          >Choose {{ crypt_type.get('display_name') }} Type:</label
        >
        <select
          id="cryptEnumType"
          class="form-select"
          onchange="enableTextarea()"
        >
          <option value="">Select</option>
          {% for type in crypt_type_enum %}
          <option value="{{ type.get('enum_id') }}">
            {{ type.get('enum_type') }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="textarea-container position-relative mb-3">
      <textarea
        id="plaintext"
        class="form-control"
        placeholder="Enter plaintext here"
        disabled
      ></textarea>
      <button
        id="sendButton"
        class="btn btn-primary"
        onclick="encryptText()"
        disabled
      >
        Send
      </button>
    </div>

    <textarea
      id="ciphertext"
      class="form-control"
      placeholder="Ciphertext will appear here"
      readonly
    ></textarea>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.min.js"></script>
    <script>
      function enableTextarea() {
        const cryptEnumType = document.getElementById("cryptEnumType").value;
        const plaintext = document.getElementById("plaintext");
        const sendButton = document.getElementById("sendButton");
        plaintext.disabled = !cryptEnumType;
        sendButton.disabled = !cryptEnumType; // Enable button only when a type is selected
      }

      function encryptText() {
        const plaintext = document.getElementById("plaintext").value;
        const cryptEnumType = document.getElementById("cryptEnumType").value;
        const cryptType = "{{ crypt_type.get('display_name') }}".toLowerCase();

        const data = {
          plaintext: plaintext,
          cryptEnumType: cryptEnumType,
        };

        fetch(`/cryptography/${cryptType}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("ciphertext").value = data.ciphertext;
          })
          .catch((error) => {
            console.error(`Error:`, error);
          });
      }
    </script>
  </body>
</html>
